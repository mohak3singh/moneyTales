# Enabling Gemini 2.5 Flash API for Personalized Quizzes

## Overview
The MoneyTales platform now supports Google's Gemini 2.5 Flash API for generating personalized, context-aware quiz questions based on user's learning history and performance.

## Prerequisites
- Google Account with access to Google AI Studio
- Gemini API enabled in your Google Cloud project

## Setup Steps

### 1. Get Your Gemini API Key

#### Option A: Using Google AI Studio (Free)
1. Go to [Google AI Studio](https://aistudio.google.com/)
2. Click on "Get API Key" in the left sidebar
3. Create a new API key
4. Copy your API key (keep it secure!)

#### Option B: Using Google Cloud Console
1. Go to [Google Cloud Console](https://console.cloud.google.com/)
2. Create a new project or select existing
3. Enable the "Generative Language API"
4. Create an API key in Credentials section
5. Copy your API key

### 2. Set Environment Variable

#### For Development (Local Machine)
```bash
# Add to your .env file (create if doesn't exist)
echo 'GEMINI_API_KEY=your-api-key-here' > /path/to/MoneyTales/.env

# Or set it temporarily in terminal
export GEMINI_API_KEY="your-api-key-here"
```

#### For Production (Server)
Add to your environment configuration:
```bash
export GEMINI_API_KEY="your-api-key-here"
```

Or add to your docker-compose.yml:
```yaml
environment:
  - GEMINI_API_KEY=your-api-key-here
```

### 3. Restart the Backend

```bash
# Kill existing process
pkill -f "uvicorn"

# Restart backend
cd /path/to/MoneyTales
python3 -m uvicorn backend.main:app --port 8000
```

### 4. Verify Setup

Check the logs to confirm Gemini is initialized:
```bash
# Should see: "✅ Gemini API initialized"
tail -f /tmp/backend.log | grep -i gemini
```

## How It Works

### Quiz Generation with Personalization
When a user generates a quiz, the system:

1. **Fetches User History**: Retrieves the last 5 quizzes the user completed
2. **Analyzes Performance**: Extracts topics covered and average scores
3. **Generates Questions**: Uses Gemini to create personalized questions that:
   - Build on previous topics
   - Match the user's current difficulty level
   - Are age-appropriate and engaging
   - Include varied question types and scenarios

### Performance Analysis
After quiz submission, Gemini helps:
1. **Analyze Performance**: Considers user's history and current score
2. **Generate Feedback**: Creates encouraging, personalized feedback
3. **Recommend Difficulty**: Suggests next difficulty level based on pattern

## Example Usage

### Generate Personalized Quiz
```bash
curl -X POST http://localhost:8000/api/quiz/generate \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": "child_001",
    "topic": "Saving Money"
  }'
```

The response will include personalized questions generated by Gemini based on the user's age and previous quiz history.

### Submit Answers with Personalized Feedback
```bash
curl -X POST http://localhost:8000/api/submit/answers \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": "child_001",
    "topic": "Saving Money",
    "questions": [...],
    "answers": [0, 1, 2, 1, 0]
  }'
```

The response includes Gemini-enhanced feedback and difficulty recommendations.

## Troubleshooting

### Issue: "GEMINI_API_KEY not set"
**Solution**: Verify environment variable is set:
```bash
echo $GEMINI_API_KEY
```
Should output your API key. If empty, set it again.

### Issue: "Invalid API Key"
**Solution**: 
1. Verify key is correct (copy from Google AI Studio again)
2. Check for extra spaces or quotes
3. Regenerate the key in Google AI Studio

### Issue: "Gemini API not responding"
**Solution**:
1. Check internet connection
2. Verify API is enabled in Google Cloud Console
3. Check Google Cloud status page for outages
4. The system will automatically fall back to template questions

## Disabling Gemini (Fallback Mode)

If you want to use only template questions:
1. Don't set GEMINI_API_KEY environment variable
2. System will automatically use fallback mode
3. No changes needed to code

The system will log: `"⚠️  GEMINI_API_KEY not set. Using default topics."`

## API Rate Limits

Google's free tier includes:
- **Requests**: 60 per minute
- **Tokens**: 4,000 per minute

For production, consider upgrading to a paid plan.

## Security Best Practices

1. **Never commit API keys** to version control
2. **Use environment variables** for API keys
3. **Rotate keys regularly** in production
4. **Monitor usage** in Google Cloud Console
5. **Set up billing alerts** to prevent unexpected costs

## Cost Estimation

**Current Implementation**:
- Quiz Generation: 1 Gemini API call per quiz
- Feedback Analysis: 1 Gemini API call per submission
- **Cost**: ~$0.000002 per request (very low cost)

**Estimate for 1000 quizzes/day**: < $1/month

## Support

For API issues:
- [Google Generative AI Documentation](https://ai.google.dev/docs)
- [Google AI Studio Help](https://aistudio.google.com/)
- [API Error Codes Documentation](https://ai.google.dev/docs/concepts/error-codes)

## Next Steps

1. ✅ Set up Gemini API key
2. ✅ Restart backend
3. ✅ Test quiz generation
4. ✅ Monitor logs for any issues
5. ✅ Enjoy personalized quizzes!

---

**Version**: 1.0
**Last Updated**: December 2, 2025
